function Connect-CSVM {
    [CmdletBinding()]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute('AvoidUsingConvertToSecureStringWithPlainText', '', Justification = 'SecureStrings main usage is to stop items from appearing in the console, and not encrypting memory', Scope = 'Function')]
    param (
        [Parameter(Mandatory = $true,
            ParameterSetName = 'StdAuth',
            HelpMessage = 'The client ID from the Sophos Central API credential/service principal')]
        [String]$ClientID,

        [Parameter(ParameterSetName = 'StdAuth',
            HelpMessage = 'The client secret from the Sophos Central API credential/service principal')]
        [SecureString]$ClientSecret,

        [String]$Url,

        [String]$Tenant
    )

    $SCRIPT:CSVMAuth = @{
        clientId     = $ClientID
        clientSecret = $ClientSecret
        tenant       = $Tenant
        url          = [System.Uri]::New($Url)
        customerId   = $null
    }

    #Get Companies to test auth
    $url = $url + '/api/company'
    $headers = Get-CSVMAuthHeader

    try {
        Invoke-RestMethod -Uri $Url -Headers $headers | Out-Null
    } catch {
        Write-Error 'Error connecting to API, check creds and server'
        Write-Debug $_
    }
}
